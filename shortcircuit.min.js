var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)},c="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function f(){f=function(){};c.Symbol||(c.Symbol=ba)}var ca=0;function ba(a){return"jscomp_symbol_"+(a||"")+ca++}
function n(){f();var a=c.Symbol.iterator;a||(a=c.Symbol.iterator=c.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return p(this)}});n=function(){}}function p(a){var d=0;return da(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})}function da(a){n();a={next:a};a[c.Symbol.iterator]=function(){return this};return a}function ea(a){n();f();n();var d=a[Symbol.iterator];return d?d.call(a):p(a)}
var r="1"!=q("mute"),t,u=[200,300,400,500,600,800,900,1E3],v=[],w=0,x=[],z=0,fa=0,ga=null,A=!1;function ja(){var a=v[w];a&&a.disconnect();x=[]}function B(a){C=a;D=ka(a);E=F=0;setTimeout(G,100);C&&la("level",C)}function ma(){ja();confirm("Restart level?")&&B(C)}function H(){var a=I,d=a?.5:1,b=Math.min(800,Math.max(240,10*Math.floor(Math.min(window.innerWidth,window.innerHeight-60)/10))),a=a?2*b:b;J.width!=a&&(J.style.width=J.style.height=b+"px",J.width=J.height=a,K.scale(d,d),L(),M())}
function ka(a){var d=[],b=document.getElementsByTagName("map");if(a>=b.length)return null;a=b[a].innerHTML.split(String.fromCharCode(10)).filter(function(a){return""!=a.trim()});for(b=0;b<a.length;b++)for(var e=0;e<a[b].length/2;e++){var h=a[b].substr(2*e,2),g=null;switch(h.charAt(0)){case "X":g={type:"hole",x:e,y:b,floor:!0,g:!0};N(g,h);break;case "^":g={x:e,y:b,type:"hero"};g.b=g.c=0;break;case "D":g={type:"door",x:e,y:b,g:!0,floor:!0};N(g,h);break;case "F":g={type:"floor",x:e,y:b,floor:!0};N(g,
h);break;case "R":g={type:"boulder",x:e,y:b};N(g,h);break;case "B":g={type:"block",x:e,y:b,g:!0};N(g,h);break;case "E":g={type:"block",x:e,y:b,g:!0,j:!0};N(g,h);break;case "~":g={type:"sign",x:e,y:b,floor:!0},g.o=h.charAt(1)}g&&d.push(g)}return d}function N(a,d){var b=parseInt(d.charAt(1),16);b&&!isNaN(b)&&(a.a=b)}var D=[],C=0,O={},P=!0,J=document.getElementById("view"),Q=J.width/10,K=J.getContext("2d"),R=document.getElementById("controls-portrait"),S=R.getContext("2d"),T=0,E=0,F=0;
function na(){var a=Math.max(0,Math.min(1,(F+2500-E)/1E3));if(1<=C&&0<a){var d=C+"",b=2<=d.length?-Q:0;K.font=4*Q+"px Arial Black";K.fillStyle="rgba(0, 0, 0, "+a+")";K.fillText(d,b+3.7*Q,5*Q);K.strokeStyle="rgba(0, 0, 0, "+a+")";K.lineWidth=Q/20;K.fillStyle="rgba(255, 255, 255, "+a+")";K.fillText(d,b+3.7*Q-Q/5,5*Q-Q/5);K.strokeText(d,b+3.7*Q-Q/5,5*Q-Q/5)}}
function L(a){if(a-E>1E3/30){Q=J.width/10/(I?.5:1);E=a;F||(F=E);K.clearRect(0,0,10*Q,10*Q);K.fillStyle="rgb(230,230,230)";for(a=0;10>a;a++)for(var d=0;10>d;d++)oa(d,a);pa(D.filter(function(a){return a.floor}));pa(D.filter(function(a){return!a.floor}));na();M();if(r){clearTimeout(ga);t||(t=new AudioContext);if(180<E-fa){fa=E;if(!x[z]||A&&.3>Math.random())x[z]=u[parseInt(Math.random()*u.length)],A=!1;w!=x[z]&&(w&&v[w].disconnect(),w=x[z],v[w]||(v[w]=t.createOscillator(),v[w].frequency.value=w,v[w].start(0)),
v[w].connect(t.destination));z=(z+1)%8}ga=setTimeout(ja,100)}}P&&window.requestAnimationFrame(L)}
function M(){var a=I?.5:1,d=window.innerWidth<window.innerHeight;document.getElementById("touchControls").style.display=U()&&d?"":"none";document.getElementById("notouch").style.display=1>=C&&!U()?"":"none";document.getElementById("controls-landscape").style.display=U()&&!d?"":"none";R=document.getElementById(d?"controls-portrait":"controls-landscape");R.width=R.height=a*J.width/8*5;S=R.getContext("2d");a=R.width/50;S.fillStyle="#555555";S.beginPath();S.arc(25*a,10*a,8*a,0,2*Math.PI,!0);S.moveTo(10*
a,25*a);S.arc(10*a,25*a,8*a,0,2*Math.PI,!0);S.moveTo(40*a,25*a);S.arc(40*a,25*a,8*a,0,2*Math.PI,!0);S.moveTo(25*a,40*a);S.arc(25*a,40*a,8*a,0,2*Math.PI,!0);S.fill();a=document.getElementById("restartButton");a.style.display=U()?"":"none";a.style.left=a.style.v=window.innerWidth-a.offsetWidth-20+"px"}
function pa(a){for(var d=0;d<a.length;d++)switch(a[d].type){case "hero":qa(a[d]);break;case "block":var b=a[d],e=Q/40;K.fillStyle="rgb(200"+Math.round(50*Math.random())+",0,230)";K.fillRect(e+b.x*Q,e+b.y*Q,Q-2*e,Q-2*e);K.fillStyle="rgb(150,0,130)";K.fillRect(e+b.x*Q,e+b.y*Q+.8*Q,Q-2*e,Q-2*e-.8*Q);V(b);W(b,"#116600",5,.5);W(b,b.f?"#00ffff":"#33ff00",3);break;case "door":var h=a[d];V(h);W(h,"#116600",4,.5,!0);W(h,h.f?"#00ffff":"#33ff00",2,0,!0);var b=h.x*Q,e=h.y*Q,g=Q/4;K.fillStyle="#224400";K.beginPath();
K.moveTo(b+g,e+Q-g);K.lineTo(b+Q-g,e+Q-g);K.lineTo(b+Q/2,e+g/3);K.fill();K.fillStyle="#00ffff";K.beginPath();K.moveTo(b+g,e+Q-g);K.lineTo(b+Q-g,e+Q-g);K.lineTo(b+Q/2,e+g);K.fill();K.fillStyle="#336600";K.beginPath();var l=h.f?Math.max(0,1-(E-h.f)/150):1;K.moveTo(b+g*l+Q/2*(1-l),e+(Q-g)*l+g*(1-l));K.lineTo(b+(Q-g)*l+Q/2*(1-l),e+(Q-g)*l+g*(1-l));K.lineTo(b+Q/2,e+g);K.fill();h.g&&0==l?h.g=!1:0==l||h.g||(h.g=!0);h.g||(h=parseInt(250*Math.random()),K.fillStyle="rgb(255,"+h+",30)",K.beginPath(),K.moveTo(b+
Q/2,e-Q*h/500),K.lineTo(b+Q/2-Q/5,e-Q/4-Q*h/500),K.lineTo(b+Q/2+Q/5,e-Q/4-Q*h/500),K.fill());break;case "boulder":b=a[d];b.m?(b.m=!1,b.i||(b.i=!0,G())):(e=(Math.max(0,Math.min(9,Math.round(b.x)))-b.x)/2,h=(Math.max(0,Math.min(9,Math.round(b.y)))-b.y)/2,.001>e*e+h*h?b.i&&(b.i=!1,b.x=Math.round(b.x),b.y=Math.round(b.y),G()):(b.x+=e,b.y+=h));e=Q/5;K.fillStyle="#888888";K.fillRect(.8*e+b.x*Q,1.5*e+b.y*Q,Q-1.6*e,Q-2*e);K.fillStyle="rgb(100"+Math.round(30*Math.random())+",100,30)";K.fillRect(e+b.x*Q,e+
b.y*Q,Q-2*e,Q-2*e);V(b);W(b,"#116600",5,.5);W(b,b.f?"#00ffff":"#33ff00",3);break;case "floor":b=a[d];e=b.x;h=b.y;K.fillStyle="rgb(220,220,230)";K.fillRect(5+e*Q,5+h*Q,Q-10,Q-10);V(b);W(b,b.f?"#00BBBB":"#228800",4);break;case "hole":b=a[d];e=b.x;h=b.y;K.fillStyle="#000000";K.fillRect(e*Q,h*Q,Q,Q);W(b,b.f?"#00BBBB":"#228800",4);break;case "sign":b=a[d],e=b.x,h=b.y,K.font=Q+"px Courier",K.fillStyle="#000000",K.fillRect(e*Q,h*Q,Q,Q),K.fillStyle="#EEEE22",K.fillText(b.o,b.x*Q,b.y*Q+Q/2)}}
function ra(a){var d=O,b=0,e=0;d[37]&&b--;d[39]&&b++;d[38]&&e--;d[40]&&e++;b||e||T||(b=a.b,e=a.c);return[b,e]}function sa(a,d){return D.filter(function(b){return Math.round(b.x)==a&&Math.round(b.y)==d})}
function X(a,d,b,e){if(0>d||0>b||9<d||9<b)return!1;d=Math.round(d);b=Math.round(b);for(var h=d-a.x,g=b-a.y,l=sa(d,b),m=0;m<l.length;m++){var y=l[m];if("hero"!==y.type){if(y.g||e&&y!=a&&"boulder"==y.type)return!1;if(!e&&"boulder"==y.type){var ha=h,ia=g;Math.abs(y.x-a.x)>Math.abs(y.y-a.y)?ia=0:ha=0;if(!X(y,d+ha,b+ia,!0))return!1}}}return!0}function Y(a){return 0>a?0:9<a?9:a}
function ta(a,d,b,e){var h=a,g=d;a=Math.round(a+b);d=Math.round(d+e);for(var l=0;l<D.length;l++){var m=D[l];if(Math.round(m.x)==a&&Math.round(m.y)==d&&"boulder"==m.type)return Math.abs(m.x-h)>Math.abs(m.y-g)?e=0:b=0,X(m,m.x+b,m.y+b,!0)?(m.x=Y(m.x+b),m.y=Y(m.y+e),m.m=!0,m):!1}return ua}var ua={type:"none"};
function qa(a){var d=Math.round(a.x),b=Math.round(a.y),e=ea(ra(a)),h=e.next().value,e=e.next().value;a.h&&(e=h=0);var g=a.l?a.l:.22;a.b=0>h?Math.max(a.b-.05,-g):0<h?Math.min(a.b+.05,g):a.b/3;a.c=0>e?Math.max(a.c-.05,-g):0<e?Math.min(a.c+.05,g):a.c/3;h=h?a.b:(Math.max(0,Math.min(9,Math.round(a.x+a.b)))-a.x)/2;e=e?a.c:(Math.max(0,Math.min(9,Math.round(a.y+a.c)))-a.y)/2;X(a,a.x+h,a.y,!1)||(h=0,a.b/=2,T++);X(a,a.x,a.y+e,!1)||(e=0,a.c/=2,T++);(g=ta(a.x+h,a.y+e,h,e))?a.l="boulder"==g.type?.08:null:(h=0,
a.b/=2,e=0,a.c/=2,T++);.01>Math.abs(a.b)+Math.abs(a.c)?T=a.b=a.c=0:A=!0;var g=Q/4,l=1.8*h*g,m=1.8*e*g;a.x=Y(a.x+h);a.y=Y(a.y+e);Math.round(a.x)==d&&Math.round(a.y)==b||T++;!a.h&&0<sa(Math.round(a.x),Math.round(a.y)).filter(function(a){return"door"==a.type}).length&&(a.h=E);d=a.h?Math.sqrt(Math.max(0,1-(E-a.h)/250)):1;K.fillStyle="#888888";K.beginPath();K.ellipse(a.x*Q+Q/2,a.y*Q+Q/2*d+(Q-Q/3)*(1-d)+g*d*.8,g*d*.9,g*d/3,0,0,2*Math.PI,!0);K.fill();K.strokeStyle="rgb(200,150,30)";K.fillStyle="rgb(240,240,30)";
K.lineWidth=g/6;K.beginPath();K.arc(a.x*Q+Q/2,a.y*Q+Q/2*d+(Q-Q/3)*(1-d),g*d,0,2*Math.PI,!0);K.fill();K.stroke();a.h||(K.beginPath(),K.arc(l+a.x*Q+Q/2,m+a.y*Q+Q/2,g/1.5,.2*Math.PI,.8*Math.PI,!1),K.stroke(),K.beginPath(),K.arc(l+a.x*Q+Q/2-g/3,m+a.y*Q+Q/2-3,g/6,.1*-Math.PI,.9*-Math.PI,!0),K.stroke(),K.beginPath(),K.arc(l+a.x*Q+Q/2+g/3,m+a.y*Q+Q/2-3,g/6,.1*-Math.PI,.9*-Math.PI,!0),K.stroke());a.h&&0==d&&!a.s&&(a.s=!0,C++,B(C),M(),D||(D=[],alert("Game Over")))}
function oa(a,d){var b=Q/8;K.fillRect(b+a*Q,b+d*Q,Q-2*b,Q-2*b)}function V(a){a.j&&(K.strokeStyle="rgb(200,200,30)",K.fillStyle="rgb(250,250,30)",K.lineWidth=2,K.beginPath(),K.arc(a.x*Q+Q/2,a.y*Q+Q/2,10,0,2*Math.PI,!0),K.fill())}
function W(a,d,b,e,h){if(a.a){e||(e=0);var g=a.x,l=a.y;K.lineWidth=b*(I?2:1);K.strokeStyle=d;K.beginPath();d=Q/8;h||K.arc(a.x*Q+Q/2,a.y*Q+Q/2,d,0,2*Math.PI,!0);a.a&1&&(K.moveTo(g*Q+Q/2-d,l*Q+Q/2),K.lineTo(g*Q+e,l*Q+Q/2));a.a&2&&(K.moveTo(g*Q+Q/2,l*Q+Q/2-d),K.lineTo(g*Q+Q/2,l*Q+e));a.a&4&&(K.moveTo(g*Q+Q/2+d,l*Q+Q/2),K.lineTo(g*Q+Q-e,l*Q+Q/2));a.a&8&&(K.moveTo(g*Q+Q/2,l*Q+Q/2+d),K.lineTo(g*Q+Q/2,l*Q+Q-e));K.stroke()}}
function G(){for(var a=0;a<D.length;a++)D[a].f&&(D[a].f=!1),D[a].id=a;for(a=0;a<D.length;a++)D[a].j&&va(D[a])}function wa(a,d){if(a.i||d.i)return!1;var b=d.x-a.x,e=d.y-a.y;return 1==b&&0==e?a.a&4&&d.a&1:-1==b&&0==e?a.a&1&&d.a&4:0==b&&1==e?a.a&8&&d.a&2:0==b&&-1==e?a.a&2&&d.a&8:!1}
function va(a,d){d||(d={});if(d[a.id])return!1;d[a.id]=!0;"door"==a.type&&(a.f=E);for(var b=D.filter(function(b){return b.a&&1==Math.abs(b.x-a.x)+Math.abs(b.y-a.y)}),e=0;e<b.length;e++){var h=b[e];wa(a,h)&&va(h,d)&&(a.f=!0)}return a.f}function U(){return"ontouchstart"in window||0<navigator.u||0<navigator.msMaxTouchPoints}var Z=String.fromCharCode(92);function q(a){return(a=location.hash.match(new RegExp(Z+"b"+a+"=("+Z+"d+)")))?parseInt(a[a.length-1]):null}
function la(a,d){var b;b=null!==q(a)?location.hash.replace(new RegExp(Z+"b"+a+"="+Z+"d+"),d?a+"="+d:""):"#"==location.hash?a+"="+d:location.hash+("&"+a+"="+d);b=b.replace(/&+/,"&");b=b.replace(/&$/,"");location.hash=b}var I=xa();function xa(){return null!==q("retina")?1==q("retina"):2<=window.devicePixelRatio||window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 2),(min--moz-device-pixel-ratio: 2),(-o-min-device-pixel-ratio: 2),(min-resolution: 2dppx)").matches?!0:!1}
window.onfocus=function(){P=!0;L()};window.onblur=function(){P=!1};window.onkeyup=window.onkeydown=function(a){a||(a=event);if("keydown"==a.type){for(k in O)O[k]=!1;O[a.keyCode]=!0}else O[a.keyCode]=!1,27==a.keyCode?ma():83==a.keyCode&&(r=!r,la("mute",r?null:1));a.preventDefault()};
function ya(a){a=a.targetTouches[0];var d=a.pageX-R.offsetLeft;a=a.pageY-R.offsetTop;for(var b=R.width/50,e=[38,37,39,40],h=[{x:25*b,y:10*b},{x:10*b,y:25*b},{x:40*b,y:25*b},{x:25*b,y:40*b}],g=0;g<h.length;g++){var l=h[g].x-d,m=h[g].y-a;Math.sqrt(l*l+m*m)<10*b&&(O[e[g]]=!0)}}document.addEventListener("touchend",function(){O[37]=O[38]=O[39]=O[40]=!1});document.getElementById("controls-portrait").addEventListener("touchstart",ya);
document.getElementById("controls-landscape").addEventListener("touchstart",ya);document.getElementById("restartButton").addEventListener("touchend",function(){ma()});function za(){var a=q("level"),d=document.getElementsByTagName("map");return a?Math.max(0,Math.min(d.length,a)):0}window.addEventListener("resize",H);window.addEventListener("orientationchange",H);window.addEventListener("hashchange",function(){I=xa();H();null!==q("mute")&&(r="1"!=q("mute"));var a=za();C!=a&&B(a)});H();C=za();B(C);
t||(t=new AudioContext);
