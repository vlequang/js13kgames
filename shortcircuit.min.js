var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)},c="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global?global:this;function f(){f=function(){};c.Symbol||(c.Symbol=ba)}var ea=0;function ba(a){return"jscomp_symbol_"+(a||"")+ea++}
function m(){f();var a=c.Symbol.iterator;a||(a=c.Symbol.iterator=c.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return p(this)}});m=function(){}}function p(a){var d=0;return fa(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})}function fa(a){m();a={next:a};a[c.Symbol.iterator]=function(){return this};return a}function ga(a){m();f();m();var d=a[Symbol.iterator];return d?d.call(a):p(a)}
var q,r=[200,300,400,500,600,800,900,1E3],t=[],u=0,v=[],w=0,y=0,z=null,A=!1;function B(){var a=t[u];a&&a.disconnect();v=[]}function C(){B();confirm("Restart level?")&&(D=E())}function F(){var a=G(),d=a?.5:1,b=Math.min(800,Math.max(240,10*Math.floor(Math.min(window.innerWidth,window.innerHeight-50)/10))),a=a?2*b:b;H.width!=a&&(H.style.width=H.style.height=b+"px",H.width=H.height=a,I.scale(d,d),J(),K())}
function E(){var a=L,d=[],b=document.getElementsByTagName("map");if(a-1>=b.length)return null;a=b[a-1].innerHTML.split(String.fromCharCode(10)).filter(function(a){return""!=a.trim()});for(b=0;b<a.length;b++)for(var e=0;e<a[b].length/2;e++){var g=a[b].substr(2*e,2),h=null;switch(g.charAt(0)){case "X":h={type:"hole",x:e,y:b,floor:!0,g:!0};M(h,g);break;case "^":h={x:e,y:b,type:"hero"};h.b=h.c=0;break;case "D":h={type:"door",x:e,y:b,g:!0,floor:!0};M(h,g);break;case "F":h={type:"floor",x:e,y:b,floor:!0};
M(h,g);break;case "R":h={type:"boulder",x:e,y:b};M(h,g);break;case "B":h={type:"block",x:e,y:b,g:!0};M(h,g);break;case "E":h={type:"block",x:e,y:b,g:!0,j:!0},M(h,g)}h&&d.push(h)}return d}function M(a,d){var b=parseInt(d.charAt(1),16);b&&!isNaN(b)&&(a.a=b)}var D=[],L=1,N={},O=!0,H=document.getElementById("view"),P=H.width/10,I=H.getContext("2d"),Q=document.getElementById("controls-portrait"),R=Q.getContext("2d"),S=0,T=0;
function J(a){var d=G()?.5:1;P=H.width/10/d;if(a-T>1E3/60){T=a;I.clearRect(0,0,10*P,10*P);for(a=0;10>a;a++)for(d=0;10>d;d++)ha(d,a);U(D.filter(function(a){return a.floor}));U(D.filter(function(a){return!a.floor}));K()}O&&window.requestAnimationFrame(J);clearTimeout(z);q||(q=new AudioContext);if(180<T-y){y=T;if(!v[w]||A&&.3>Math.random())v[w]=r[parseInt(Math.random()*r.length)],A=!1;u!=v[w]&&(u&&t[u].disconnect(),u=v[w],t[u]||(t[u]=q.createOscillator(),t[u].frequency.value=u,t[u].start(0)),t[u].connect(q.destination));
w=(w+1)%8}z=setTimeout(B,100)}
function K(){var a=G()?.5:1,d=window.innerWidth<window.innerHeight;document.getElementById("touchControls").style.display=V()&&d?"":"none";document.getElementById("notouch").style.display=V()?"none":"";document.getElementById("controls-landscape").style.display=V()&&!d?"":"none";Q=document.getElementById(d?"controls-portrait":"controls-landscape");Q.width=Q.height=a*H.width/8*5;R=Q.getContext("2d");a=Q.width/50;R.fillStyle="#555555";R.beginPath();R.arc(25*a,10*a,8*a,0,2*Math.PI,!0);R.moveTo(10*a,
25*a);R.arc(10*a,25*a,8*a,0,2*Math.PI,!0);R.moveTo(40*a,25*a);R.arc(40*a,25*a,8*a,0,2*Math.PI,!0);R.moveTo(25*a,40*a);R.arc(25*a,40*a,8*a,0,2*Math.PI,!0);R.fill();a=document.getElementById("restartButton");a.style.display=V()?"":"none";a.style.left=a.style.s=window.innerWidth-a.offsetWidth-20+"px"}
function U(a){for(var d=0;d<a.length;d++)switch(a[d].type){case "hero":ia(a[d]);break;case "block":var b=a[d];I.fillStyle="rgb(200"+Math.round(50*Math.random())+",0,230)";I.fillRect(1+b.x*P,1+b.y*P,P-2,P-2);W(b);X(b,"#116600",5,.5);X(b,b.f?"#00ffff":"#33ff00",3);break;case "door":var e=a[d];W(e);X(e,"#116600",4,.5);X(e,e.f?"#00ffff":"#33ff00",2);var b=e.x*P,g=e.y*P;I.fillStyle="#00ffff";I.beginPath();I.moveTo(b+10,g+P-10);I.lineTo(b+P-10,g+P-10);I.lineTo(b+P/2,g+10);I.fill();I.fillStyle="#336600";
I.beginPath();var h=e.f?Math.max(0,1-(T-e.f)/150):1;I.moveTo(b+10*h+P/2*(1-h),g+(P-10)*h+10*(1-h));I.lineTo(b+(P-10)*h+P/2*(1-h),g+(P-10)*h+10*(1-h));I.lineTo(b+P/2,g+10);I.fill();e.g&&0==h?e.g=!1:0==h||e.g||(e.g=!0);e.f&&(e=parseInt(250*Math.random()),I.fillStyle="rgb(255,"+e+",30)",I.beginPath(),I.moveTo(b+P/2,g-P*e/500),I.lineTo(b+P/2-P/5,g-P/4-P*e/500),I.lineTo(b+P/2+P/5,g-P/4-P*e/500),I.fill());break;case "boulder":b=a[d];b.l?(b.l=!1,b.i||(b.i=!0,ja())):(g=(Math.max(0,Math.min(9,Math.round(b.x)))-
b.x)/2,e=(Math.max(0,Math.min(9,Math.round(b.y)))-b.y)/2,.001>g*g+e*e?b.i&&(b.i=!1,b.x=Math.round(b.x),b.y=Math.round(b.y),ja()):(b.x+=g,b.y+=e));g=P/5;I.fillStyle="rgb(100"+Math.round(30*Math.random())+",100,30)";I.fillRect(g+b.x*P,g+b.y*P,P-2*g,P-2*g);W(b);X(b,"#116600",5,.5);X(b,b.f?"#00ffff":"#33ff00",3);break;case "floor":b=a[d];g=b.x;e=b.y;I.fillStyle="rgb(220,220,230)";I.fillRect(5+g*P,5+e*P,P-10,P-10);W(b);X(b,"#116600",4,.5);X(b,b.f?"#00ffff":"#33ff00",2);break;case "hole":b=a[d],g=b.x,e=
b.y,I.fillStyle="#000000",I.fillRect(g*P,e*P,P,P),X(b,"#116600",4,.5),X(b,b.f?"#00ffff":"#33ff00",2)}}function ka(a){var d=N,b=0,e=0;d[37]&&b--;d[39]&&b++;d[38]&&e--;d[40]&&e++;b||e||S||(b=a.b,e=a.c);return[b,e]}function la(a,d){return D.filter(function(b){return Math.round(b.x)==a&&Math.round(b.y)==d})}
function Y(a,d,b,e){if(0>d||0>b||9<d||9<b)return!1;d=Math.round(d);b=Math.round(b);for(var g=d-a.x,h=b-a.y,n=la(d,b),l=0;l<n.length;l++){var x=n[l];if("hero"!==x.type){if(x.g||e&&x!=a&&"boulder"==x.type)return!1;if(!e&&"boulder"==x.type){var ca=g,da=h;Math.abs(x.x-a.x)>Math.abs(x.y-a.y)?da=0:ca=0;if(!Y(x,d+ca,b+da,!0))return!1}}}return!0}function Z(a){return 0>a?0:9<a?9:a}
function ma(a,d,b,e){var g=a,h=d;a=Math.round(a+b);d=Math.round(d+e);for(var n=0;n<D.length;n++){var l=D[n];if(Math.round(l.x)==a&&Math.round(l.y)==d&&"boulder"==l.type)if(Math.abs(l.x-g)>Math.abs(l.y-h)?e=0:b=0,Y(l,l.x+b,l.y+b,!0)){l.x=Z(l.x+b);l.y=Z(l.y+e);l.l=!0;break}else return!1}return!0}
function ia(a){var d=Math.round(a.x),b=Math.round(a.y),e=ga(ka(a)),g=e.next().value,h=e.next().value;a.h&&(h=g=0);a.b=0>g?Math.max(a.b-.05,-.12):0<g?Math.min(a.b+.05,.12):a.b/3;a.c=0>h?Math.max(a.c-.05,-.12):0<h?Math.min(a.c+.05,.12):a.c/3;g=g?a.b:(Math.max(0,Math.min(9,Math.round(a.x+a.b)))-a.x)/2;h=h?a.c:(Math.max(0,Math.min(9,Math.round(a.y+a.c)))-a.y)/2;Y(a,a.x+g,a.y,!1)||(g=0,a.b/=2,S++);Y(a,a.x,a.y+h,!1)||(h=0,a.c/=2,S++);ma(a.x+g,a.y+h,g,h)||(g=0,a.b/=2,h=0,a.c/=2,S++);.01>Math.abs(a.b)+Math.abs(a.c)?
S=a.b=a.c=0:A=!0;var e=P/4,n=1.8*g*e,l=1.8*h*e;a.x=Z(a.x+g);a.y=Z(a.y+h);Math.round(a.x)==d&&Math.round(a.y)==b||S++;!a.h&&0<la(Math.round(a.x),Math.round(a.y)).filter(function(a){return"door"==a.type}).length&&(a.h=T);d=a.h?Math.sqrt(Math.max(0,1-(T-a.h)/250)):1;I.strokeStyle="rgb(200,150,30)";I.fillStyle="rgb(240,240,30)";I.lineWidth=e/6;I.beginPath();I.arc(a.x*P+P/2,a.y*P+P/2*d+(P-20)*(1-d),e*d,0,2*Math.PI,!0);I.fill();I.stroke();a.h||(I.beginPath(),I.arc(n+a.x*P+P/2,l+a.y*P+P/2,e/1.5,.2*Math.PI,
.8*Math.PI,!1),I.stroke(),I.beginPath(),I.arc(n+a.x*P+P/2-e/3,l+a.y*P+P/2-3,e/6,.1*-Math.PI,.9*-Math.PI,!0),I.stroke(),I.beginPath(),I.arc(n+a.x*P+P/2+e/3,l+a.y*P+P/2-3,e/6,.1*-Math.PI,.9*-Math.PI,!0),I.stroke());a.h&&0==d&&!a.m&&(a.m=!0,L++,D=E(),console.log("Next level"),D||(D=[],alert("Game Over")))}function ha(a,d){I.fillStyle="rgb(230,230,230)";I.fillRect(5+a*P,5+d*P,P-10,P-10)}
function W(a){a.j&&(I.strokeStyle="rgb(200,200,30)",I.fillStyle="rgb(250,250,30)",I.lineWidth=2,I.beginPath(),I.arc(a.x*P+P/2,a.y*P+P/2,10,0,2*Math.PI,!0),I.fill())}
function X(a,d,b,e){if(a.a){e||(e=0);var g=a.x,h=a.y;I.lineWidth=b*(G()?2:1);I.strokeStyle=d;I.beginPath();d=P/8;I.arc(a.x*P+P/2,a.y*P+P/2,d,0,2*Math.PI,!0);a.a&1&&(I.moveTo(g*P+P/2-d,h*P+P/2),I.lineTo(g*P+e,h*P+P/2));a.a&2&&(I.moveTo(g*P+P/2,h*P+P/2-d),I.lineTo(g*P+P/2,h*P+e));a.a&4&&(I.moveTo(g*P+P/2+d,h*P+P/2),I.lineTo(g*P+P-e,h*P+P/2));a.a&8&&(I.moveTo(g*P+P/2,h*P+P/2+d),I.lineTo(g*P+P/2,h*P+P-e));I.stroke()}}
function ja(){for(var a=0;a<D.length;a++)D[a].f&&(D[a].f=!1),D[a].id=a;for(a=0;a<D.length;a++)D[a].j&&na(D[a])}function oa(a,d){if(a.i||d.i)return!1;var b=d.x-a.x,e=d.y-a.y;return 1==b&&0==e?a.a&4&&d.a&1:-1==b&&0==e?a.a&1&&d.a&4:0==b&&1==e?a.a&8&&d.a&2:0==b&&-1==e?a.a&2&&d.a&8:!1}
function na(a,d){d||(d={});if(d[a.id])return!1;d[a.id]=!0;"door"==a.type&&(a.f=T);for(var b=D.filter(function(b){return b.a&&1==Math.abs(b.x-a.x)+Math.abs(b.y-a.y)}),e=0;e<b.length;e++){var g=b[e];oa(a,g)&&na(g,d)&&(a.f=!0)}return a.f}function V(){return"ontouchstart"in window||0<navigator.o||0<navigator.msMaxTouchPoints}
function G(){return 2<=window.devicePixelRatio||window.matchMedia&&window.matchMedia("(-webkit-min-device-pixel-ratio: 2),(min--moz-device-pixel-ratio: 2),(-o-min-device-pixel-ratio: 2),(min-resolution: 2dppx)").matches?!0:!1}window.onfocus=function(){O=!0;J()};window.onblur=function(){O=!1};window.onkeyup=window.onkeydown=function(a){a||(a=event);if("keydown"==a.type){for(k in N)N[k]=!1;N[a.keyCode]=!0}else N[a.keyCode]=!1,27==a.keyCode&&C();a.preventDefault()};
function pa(a){a=a.targetTouches[0];var d=a.pageX-Q.offsetLeft;a=a.pageY-Q.offsetTop;for(var b=Q.width/50,e=[38,37,39,40],g=[{x:25*b,y:10*b},{x:10*b,y:25*b},{x:40*b,y:25*b},{x:25*b,y:40*b}],h=0;h<g.length;h++){var n=g[h].x-d,l=g[h].y-a;Math.sqrt(n*n+l*l)<10*b&&(N[e[h]]=!0)}}document.addEventListener("touchend",function(){N[37]=N[38]=N[39]=N[40]=!1});document.getElementById("controls-portrait").addEventListener("touchstart",pa);
document.getElementById("controls-landscape").addEventListener("touchstart",pa);document.getElementById("restartButton").addEventListener("touchend",function(){C()});window.addEventListener("resize",F);window.addEventListener("orientationchange",F);F();D=E();q||(q=new AudioContext);
